{% extends "base.html" %}

{% block title %}{{ user.full_name }} - –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å{% endblock %}

{% block extra_css %}
<style>
    .modal-backdrop {
        z-index: 1040 !important;
    }
    .modal {
        z-index: 1050 !important;
    }
</style>
{% endblock %}

{% block content %}
<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
    <h1 class="h2">
        <i class="bi bi-person-circle"></i>
        {{ user.full_name }}
    </h1>
    <div class="btn-toolbar mb-2 mb-md-0">
        <a href="{{ url_for('users') }}" class="btn btn-sm btn-outline-secondary">
            <i class="bi bi-arrow-left"></i> –ù–∞–∑–∞–¥
        </a>
    </div>
</div>

<div class="row">
    <div class="col-lg-4">
        <div class="card shadow mb-4">
            <div class="card-header py-3">
                <h6 class="m-0 font-weight-bold text-primary">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h6>
            </div>
            <div class="card-body">
                <div class="text-center mb-4">
                    <div class="user-avatar mx-auto" style="width: 80px; height: 80px; font-size: 2rem;">
                        {{ user.full_name[0] if user.full_name else 'U' }}
                    </div>
                    <h5 class="mt-3">{{ user.full_name }}</h5>
                    <p class="text-muted">@{{ user.username }}</p>
                </div>

                <table class="table table-sm">
                    <tr>
                        <td><strong>ID:</strong></td>
                        <td><code>{{ user_id }}</code></td>
                    </tr>
                    <tr>
                        <td><strong>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è:</strong></td>
                        <td>{{ user.first_seen|replace('T', ' ') if user.first_seen else 'N/A' }}</td>
                    </tr>
                    <tr>
                        <td><strong>–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ:</strong></td>
                        <td>{{ user.messages_sent }} —Å–æ–æ–±—â–µ–Ω–∏–π</td>
                    </tr>
                    <tr>
                        <td><strong>–ü–æ–ª—É—á–µ–Ω–æ:</strong></td>
                        <td>{{ user.messages_received }} —Å–æ–æ–±—â–µ–Ω–∏–π</td>
                    </tr>
                </table>
            </div>
        </div>

        <div class="card shadow mb-4">
            <div class="card-header py-3">
                <h6 class="m-0 font-weight-bold text-primary">–°—Ç–∞—Ç—É—Å—ã</h6>
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <div class="status-item mb-2">
                        {% if is_admin %}
                            <span class="badge badge-admin p-2 d-block mb-2">üëë –ê–î–ú–ò–ù–ò–°–¢–†–ê–¢–û–†</span>
                        {% else %}
                            <span class="badge bg-secondary p-2 d-block mb-2">üë§ –û–ë–´–ß–ù–´–ô –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–¨</span>
                        {% endif %}
                    </div>

                    <div class="status-item mb-2">
                        {% if is_vip %}
                            <span class="badge badge-vip p-2 d-block mb-2">
                                üíé VIP –î–û {{ vip_until.split('T')[0] if vip_until else 'N/A' }}
                            </span>
                        {% else %}
                            <span class="badge bg-secondary p-2 d-block mb-2">‚ùå –ë–ï–ó VIP</span>
                        {% endif %}
                    </div>

                    <div class="status-item mb-2">
                        {% if is_banned %}
                            <span class="badge badge-banned p-2 d-block mb-2">üö´ –ó–ê–ë–ê–ù–ï–ù</span>
                        {% else %}
                            <span class="badge bg-success p-2 d-block mb-2">‚úÖ –ê–ö–¢–ò–í–ï–ù</span>
                        {% endif %}
                    </div>

                    <div class="status-item">
                        {% if is_protected %}
                            <span class="badge badge-protected p-2 d-block">üõ° –ó–ê–©–ò–©–Å–ù</span>
                        {% else %}
                            <span class="badge bg-secondary p-2 d-block">üõ° –ù–ï –ó–ê–©–ò–©–Å–ù</span>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-lg-8">
        <div class="card shadow mb-4">
            <div class="card-header py-3">
                <h6 class="m-0 font-weight-bold text-primary">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º</h6>
            </div>
            <div class="card-body">
                <form method="POST" action="{{ url_for('manage_user', user_id=user_id) }}" id="userForm">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <h6><i class="bi bi-gem"></i> VIP –ü–æ–¥–ø–∏—Å–∫–∞</h6>
                            {% if is_vip %}
                                <button type="button" class="btn btn-warning btn-sm w-100 mb-2" data-bs-toggle="modal" data-bs-target="#removeVipModal">
                                    <i class="bi bi-x-circle"></i> –£–¥–∞–ª–∏—Ç—å VIP
                                </button>
                            {% else %}
                                <button type="button" class="btn btn-primary btn-sm w-100 mb-2" data-bs-toggle="modal" data-bs-target="#addVipModal">
                                    <i class="bi bi-plus-circle"></i> –í—ã–¥–∞—Ç—å VIP
                                </button>
                            {% endif %}
                        </div>

                        <div class="col-md-6 mb-3">
                            <h6><i class="bi bi-lock"></i> –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞</h6>
                            {% if is_banned %}
                                <button type="button" class="btn btn-success btn-sm w-100 mb-2" data-bs-toggle="modal" data-bs-target="#unbanModal">
                                    <i class="bi bi-unlock"></i> –†–∞–∑–±–∞–Ω–∏—Ç—å
                                </button>
                            {% else %}
                                <button type="button" class="btn btn-danger btn-sm w-100 mb-2" data-bs-toggle="modal" data-bs-target="#banModal">
                                    <i class="bi bi-lock"></i> –ó–∞–±–∞–Ω–∏—Ç—å
                                </button>
                            {% endif %}
                        </div>

                        <div class="col-md-6 mb-3">
                            <h6><i class="bi bi-shield-check"></i> –ó–∞—â–∏—Ç–∞</h6>
                            {% if is_protected %}
                                <button type="button" class="btn btn-info btn-sm w-100 mb-2" data-bs-toggle="modal" data-bs-target="#removeProtectModal">
                                    <i class="bi bi-shield-slash"></i> –°–Ω—è—Ç—å –∑–∞—â–∏—Ç—É
                                </button>
                            {% else %}
                                <button type="button" class="btn btn-info btn-sm w-100 mb-2" data-bs-toggle="modal" data-bs-target="#addProtectModal">
                                    <i class="bi bi-shield-check"></i> –ó–∞—â–∏—Ç–∏—Ç—å
                                </button>
                            {% endif %}
                        </div>

                        <div class="col-md-6 mb-3">
                            <h6><i class="bi bi-lightning"></i> –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</h6>
                            <div class="d-grid gap-2">
                                <button type="button" class="btn btn-outline-primary btn-sm" onclick="copyToClipboard('{{ user_id }}')">
                                    <i class="bi bi-clipboard"></i> –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å ID
                                </button>
                                {% if user.username %}
                                <a href="https://t.me/{{ user.username }}" target="_blank" class="btn btn-outline-success btn-sm">
                                    <i class="bi bi-telegram"></i> –ù–∞–ø–∏—Å–∞—Ç—å –≤ TG
                                </a>
                                {% endif %}
                            </div>
                        </div>
                    </div>

                    <input type="hidden" name="action" id="actionInput">
                    <input type="hidden" name="days" id="daysInput">
                    <input type="hidden" name="ban_reason" id="banReasonInput">
                    <input type="hidden" name="unban_reason" id="unbanReasonInput">
                    <input type="hidden" name="protect_reason" id="protectReasonInput">
                    <input type="hidden" name="unprotect_reason" id="unprotectReasonInput">
                    <input type="hidden" name="vip_reason" id="vipReasonInput">
                    <input type="hidden" name="remove_vip_reason" id="removeVipReasonInput">
                    <input type="hidden" name="ban_type" id="banTypeInput">
                </form>
            </div>
        </div>

        <div class="card shadow mb-4">
            <div class="card-header py-3 d-flex justify-content-between align-items-center">
                <h6 class="m-0 font-weight-bold text-primary">–ò—Å—Ç–æ—Ä–∏—è –¥–µ–π—Å—Ç–≤–∏–π</h6>
                <span class="badge bg-primary">{{ user_history|length }} –∑–∞–ø–∏—Å–µ–π</span>
            </div>
            <div class="card-body">
                {% if user_history|length > 0 %}
                    <div class="table-responsive">
                        <table class="table table-hover table-sm">
                            <thead>
                                <tr>
                                    <th>–î–∞—Ç–∞</th>
                                    <th>–¢–∏–ø –¥–µ–π—Å—Ç–≤–∏—è</th>
                                    <th>–î–µ—Ç–∞–ª–∏</th>
                                    <th>–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for action in user_history|reverse %}
                                <tr>
                                    <td>
                                        <small class="text-muted">
                                            {{ action.timestamp.split('T')[0] }}<br>
                                            {{ action.timestamp.split('T')[1][:5] }}
                                        </small>
                                    </td>
                                    <td>
                                        {% if action.action_type == 'ban' %}
                                            <span class="badge bg-danger">üö´ –ë–ê–ù</span>
                                        {% elif action.action_type == 'unban' %}
                                            <span class="badge bg-success">‚úÖ –†–ê–ó–ë–ê–ù</span>
                                        {% elif action.action_type == 'vip_add' %}
                                            <span class="badge badge-vip">üíé VIP+</span>
                                        {% elif action.action_type == 'vip_remove' %}
                                            <span class="badge badge-vip">‚ùå VIP-</span>
                                        {% elif action.action_type == 'protect_add' %}
                                            <span class="badge badge-protected">üõ° –ó–ê–©–ò–¢–ê+</span>
                                        {% elif action.action_type == 'protect_remove' %}
                                            <span class="badge badge-protected">üõ° –ó–ê–©–ò–¢–ê-</span>
                                        {% else %}
                                            <span class="badge bg-secondary">{{ action.action_type }}</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        {% if action.action_type == 'ban' %}
                                            <small>
                                                –ü—Ä–∏—á–∏–Ω–∞: {{ action.details.reason }}<br>
                                                {% if action.details.until %}
                                                    –î–æ: {{ action.details.until.split('T')[0] }}
                                                {% else %}
                                                    –ù–∞–≤—Å–µ–≥–¥–∞
                                                {% endif %}
                                            </small>
                                        {% elif action.action_type == 'unban' %}
                                            <small>
                                                –ü—Ä–∏—á–∏–Ω–∞ —Å–Ω—è—Ç–∏—è: {{ action.details.reason|default('–Ω–µ —É–∫–∞–∑–∞–Ω–∞') }}
                                            </small>
                                        {% elif action.action_type == 'vip_add' %}
                                            <small>
                                                –ù–∞ {{ action.details.days }} –¥–Ω–µ–π<br>
                                                –î–æ: {{ action.details.until.split('T')[0] }}<br>
                                                {% if action.details.reason %}
                                                    –ü—Ä–∏—á–∏–Ω–∞: {{ action.details.reason }}
                                                {% endif %}
                                            </small>
                                        {% elif action.action_type == 'vip_remove' %}
                                            <small>
                                                –ü—Ä–∏—á–∏–Ω–∞ —Å–Ω—è—Ç–∏—è: {{ action.details.reason|default('–Ω–µ —É–∫–∞–∑–∞–Ω–∞') }}
                                            </small>
                                        {% elif action.action_type == 'protect_add' %}
                                            <small>
                                                {% if action.details.reason %}
                                                    –ü—Ä–∏—á–∏–Ω–∞: {{ action.details.reason }}
                                                {% endif %}
                                            </small>
                                        {% elif action.action_type == 'protect_remove' %}
                                            <small>
                                                –ü—Ä–∏—á–∏–Ω–∞ —Å–Ω—è—Ç–∏—è: {{ action.details.reason|default('–Ω–µ —É–∫–∞–∑–∞–Ω–∞') }}
                                            </small>
                                        {% endif %}
                                    </td>
                                    <td>
                                        <small>
                                            {% if action.details.admin_id %}
                                                {{ db.get_admin_number(action.details.admin_id) }}
                                            {% else %}
                                                –°–∏—Å—Ç–µ–º–∞
                                            {% endif %}
                                        </small>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                {% else %}
                    <div class="text-center py-4">
                        <i class="bi bi-clock-history display-4 text-muted"></i>
                        <p class="mt-3 text-muted">–ù–µ—Ç –∑–∞–ø–∏—Å–µ–π –≤ –∏—Å—Ç–æ—Ä–∏–∏</p>
                    </div>
                {% endif %}
            </div>
        </div>

        <div class="card shadow mb-4">
            <div class="card-header py-3 d-flex justify-content-between align-items-center">
                <h6 class="m-0 font-weight-bold text-primary">–ò—Å—Ç–æ—Ä–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π</h6>
                <span class="badge bg-primary">{{ messages|length }} —Å–æ–æ–±—â–µ–Ω–∏–π</span>
            </div>
            <div class="card-body">
                {% if messages|length > 0 %}
                    <div class="table-responsive">
                        <table class="table table-hover table-sm">
                            <thead>
                                <tr>
                                    <th>–î–∞—Ç–∞</th>
                                    <th>–¢–∏–ø</th>
                                    <th>–°–æ–æ–±—â–µ–Ω–∏–µ</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for msg in messages %}
                                <tr>
                                    <td>
                                        <small class="text-muted">
                                            {{ msg.date.split('T')[0] if msg.date else 'N/A' }}<br>
                                            {{ msg.date.split('T')[1][:5] if msg.date and 'T' in msg.date else '' }}
                                        </small>
                                    </td>
                                    <td>
                                        {% if msg.from|string == user_id %}
                                            <span class="badge bg-info">–ò—Å—Ö–æ–¥—è—â–µ–µ</span><br>
                                            <small>–ö–æ–º—É: {{ msg.to }}</small>
                                        {% else %}
                                            <span class="badge bg-success">–í—Ö–æ–¥—è—â–µ–µ</span><br>
                                            <small>–û—Ç: {{ msg.from }}</small>
                                        {% endif %}
                                    </td>
                                    <td>
                                        <div class="message-content">
                                            {% if msg.content and msg.content != '[–ú–µ–¥–∏–∞]' %}
                                                {{ msg.content|truncate(100) }}
                                            {% else %}
                                                <span class="text-muted">[–ú–µ–¥–∏–∞-—Å–æ–æ–±—â–µ–Ω–∏–µ]</span>
                                            {% endif %}
                                        </div>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                {% else %}
                    <div class="text-center py-4">
                        <i class="bi bi-chat-left-text display-4 text-muted"></i>
                        <p class="mt-3 text-muted">–ù–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–π</p>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ -->
<div class="modal fade" id="banModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label class="form-label">–¢–∏–ø –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏</label>
                    <select class="form-select" id="banTypeSelect">
                        <option value="permanent">–ù–∞–≤—Å–µ–≥–¥–∞</option>
                        <option value="temporary">–ù–∞ –≤—Ä–µ–º—è</option>
                    </select>
                </div>
                <div class="mb-3" id="daysContainer" style="display: none;">
                    <label class="form-label">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π</label>
                    <input type="number" class="form-control" id="daysValue" min="1" max="365" value="7">
                </div>
                <div class="mb-3">
                    <label class="form-label">–ü—Ä–∏—á–∏–Ω–∞ –±–∞–Ω–∞</label>
                    <input type="text" class="form-control" id="banReason" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø—Ä–∏—á–∏–Ω—É –±–∞–Ω–∞" required>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                <button type="button" class="btn btn-danger" onclick="submitBan()">–ó–∞–±–∞–Ω–∏—Ç—å</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="unbanModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label class="form-label">–ü—Ä–∏—á–∏–Ω–∞ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏</label>
                    <input type="text" class="form-control" id="unbanReason" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø—Ä–∏—á–∏–Ω—É —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏">
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                <button type="button" class="btn btn-success" onclick="submitUnban()">–†–∞–∑–±–∞–Ω–∏—Ç—å</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="addProtectModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">–í—ã–¥–∞—á–∞ –∑–∞—â–∏—Ç—ã</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label class="form-label">–ü—Ä–∏—á–∏–Ω–∞ –≤—ã–¥–∞—á–∏ –∑–∞—â–∏—Ç—ã</label>
                    <input type="text" class="form-control" id="protectReason" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø—Ä–∏—á–∏–Ω—É –≤—ã–¥–∞—á–∏ –∑–∞—â–∏—Ç—ã">
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                <button type="button" class="btn btn-info" onclick="submitAddProtect()">–í—ã–¥–∞—Ç—å –∑–∞—â–∏—Ç—É</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="removeProtectModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">–°–Ω—è—Ç–∏–µ –∑–∞—â–∏—Ç—ã</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label class="form-label">–ü—Ä–∏—á–∏–Ω–∞ —Å–Ω—è—Ç–∏—è –∑–∞—â–∏—Ç—ã</label>
                    <input type="text" class="form-control" id="unprotectReason" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø—Ä–∏—á–∏–Ω—É —Å–Ω—è—Ç–∏—è –∑–∞—â–∏—Ç—ã">
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                <button type="button" class="btn btn-info" onclick="submitRemoveProtect()">–°–Ω—è—Ç—å –∑–∞—â–∏—Ç—É</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="addVipModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">–í—ã–¥–∞—á–∞ VIP –ø–æ–¥–ø–∏—Å–∫–∏</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label class="form-label">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π</label>
                    <input type="number" class="form-control" id="vipDays" min="1" value="7">
                </div>
                <div class="mb-3">
                    <label class="form-label">–ü—Ä–∏—á–∏–Ω–∞ –≤—ã–¥–∞—á–∏ VIP</label>
                    <input type="text" class="form-control" id="vipReason" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø—Ä–∏—á–∏–Ω—É –≤—ã–¥–∞—á–∏ VIP">
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                <button type="button" class="btn btn-primary" onclick="submitAddVip()">–í—ã–¥–∞—Ç—å VIP</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="removeVipModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">–°–Ω—è—Ç–∏–µ VIP –ø–æ–¥–ø–∏—Å–∫–∏</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label class="form-label">–ü—Ä–∏—á–∏–Ω–∞ —Å–Ω—è—Ç–∏—è VIP</label>
                    <input type="text" class="form-control" id="removeVipReason" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø—Ä–∏—á–∏–Ω—É —Å–Ω—è—Ç–∏—è VIP">
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                <button type="button" class="btn btn-warning" onclick="submitRemoveVip()">–°–Ω—è—Ç—å VIP</button>
            </div>
        </div>
    </div>
</div>

<script>
    function copyToClipboard(text) {
        navigator.clipboard.writeText(text).then(function() {
            alert('ID —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞: ' + text);
        });
    }

    document.getElementById('banTypeSelect').addEventListener('change', function() {
        const daysContainer = document.getElementById('daysContainer');
        if (this.value === 'temporary') {
            daysContainer.style.display = 'block';
        } else {
            daysContainer.style.display = 'none';
        }
    });

    function submitBan() {
        const form = document.getElementById('userForm');
        form.actionInput.value = 'ban';
        form.daysInput.value = document.getElementById('daysValue').value;
        form.banReasonInput.value = document.getElementById('banReason').value;
        form.banTypeInput.value = document.getElementById('banTypeSelect').value;

        if (!form.banReasonInput.value) {
            alert('–í–≤–µ–¥–∏—Ç–µ –ø—Ä–∏—á–∏–Ω—É –±–∞–Ω–∞');
            return;
        }

        form.submit();
    }

    function submitUnban() {
        const form = document.getElementById('userForm');
        form.actionInput.value = 'unban';
        form.unbanReasonInput.value = document.getElementById('unbanReason').value;
        form.submit();
    }

    function submitAddProtect() {
        const form = document.getElementById('userForm');
        form.actionInput.value = 'protect';
        form.protectReasonInput.value = document.getElementById('protectReason').value;
        form.submit();
    }

    function submitRemoveProtect() {
        const form = document.getElementById('userForm');
        form.actionInput.value = 'unprotect';
        form.unprotectReasonInput.value = document.getElementById('unprotectReason').value;
        form.submit();
    }

    function submitAddVip() {
        const form = document.getElementById('userForm');
        form.actionInput.value = 'add_vip';
        form.daysInput.value = document.getElementById('vipDays').value;
        form.vipReasonInput.value = document.getElementById('vipReason').value;
        form.submit();
    }

    function submitRemoveVip() {
        const form = document.getElementById('userForm');
        form.actionInput.value = 'remove_vip';
        form.removeVipReasonInput.value = document.getElementById('removeVipReason').value;
        form.submit();
    }
</script>
{% endblock %}